<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ—ºï¸ Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª - Secure City IQ</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0a0e27 0%, #0f1e38 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .navbar {
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #ff4444;
            padding: 1rem 2rem;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }

        .navbar h1 {
            color: #ff4444;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .navbar .subtitle {
            color: #ff6b6b;
            font-size: 0.9rem;
            margin-top: 0.2rem;
        }

        .nav-links {
            position: absolute;
            left: 2rem;
            top: 50%;
            transform: translateY(-50%);
        }

        .nav-links a {
            color: #ff6b6b;
            text-decoration: none;
            margin-left: 1.5rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .nav-links a:hover, .nav-links a.active {
            background: rgba(255, 68, 68, 0.2);
            color: #ffb3b3;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 6rem 2rem 2rem;
        }

        .map-section {
            background: rgba(26, 42, 78, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 68, 68, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .map-section h3 {
            color: #ff4444;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            text-align: center;
        }

        .map-container {
            position: relative;
            height: 600px;
            width: 100%;
            background: linear-gradient(135deg, #1a2a4e 0%, #0f1e38 100%);
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid rgba(255, 68, 68, 0.3);
        }

        .world-map {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 8rem;
            opacity: 0.1;
            color: #ff4444;
            z-index: 1;
        }

        .threat-node {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: white;
            animation: pulse 2s infinite;
        }

        .threat-node:hover {
            transform: scale(1.5);
            z-index: 20;
        }

        .threat-node.critical {
            background: radial-gradient(circle, #8b0000, #ff0000);
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.8);
        }

        .threat-node.high {
            background: radial-gradient(circle, #ff0000, #ff4444);
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.6);
        }

        .threat-node.medium {
            background: radial-gradient(circle, #ffaa00, #ffaa00);
            box-shadow: 0 0 10px rgba(255, 170, 0, 0.5);
        }

        .threat-node.low {
            background: radial-gradient(circle, #ffff00, #ffff00);
            box-shadow: 0 0 8px rgba(255, 255, 0, 0.4);
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        .threat-tooltip {
            position: absolute;
            background: rgba(10, 14, 39, 0.95);
            border: 1px solid #ff4444;
            border-radius: 8px;
            padding: 0.5rem;
            font-size: 0.8rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 30;
            max-width: 200px;
            word-wrap: break-word;
        }

        .threat-tooltip.show {
            opacity: 1;
        }

        .controls-section {
            background: rgba(26, 42, 78, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 68, 68, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .controls-section h3 {
            color: #ff4444;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .control-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .control-btn {
            background: rgba(255, 68, 68, 0.2);
            border: 1px solid rgba(255, 68, 68, 0.5);
            color: #ffb3b3;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .control-btn:hover, .control-btn.active {
            background: rgba(255, 68, 68, 0.4);
            transform: translateY(-2px);
        }

        .legend {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .legend-dot.critical { background: #8b0000; }
        .legend-dot.high { background: #ff0000; }
        .legend-dot.medium { background: #ffaa00; }
        .legend-dot.low { background: #ffff00; }

        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(26, 42, 78, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 68, 68, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #ff4444, #ffb3b3);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            display: block;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #ffb3b3;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 1.1rem;
            color: #b0c4de;
            font-weight: 500;
        }

        .threats-list {
            background: rgba(26, 42, 78, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 68, 68, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
        }

        .threats-list h3 {
            color: #ff4444;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .threat-item {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid rgba(255, 68, 68, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.8rem;
            transition: all 0.3s ease;
        }

        .threat-item:hover {
            background: rgba(255, 68, 68, 0.2);
        }

        .threat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .threat-location {
            font-weight: 600;
            color: #ffb3b3;
        }

        .threat-severity {
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .severity-critical {
            background: rgba(139, 0, 0, 0.3);
            color: #ff6b6b;
        }

        .severity-high {
            background: rgba(255, 0, 0, 0.3);
            color: #ff6b6b;
        }

        .severity-medium {
            background: rgba(255, 170, 0, 0.3);
            color: #ffaa00;
        }

        .severity-low {
            background: rgba(255, 255, 0, 0.3);
            color: #ffff00;
        }

        .threat-details {
            font-size: 0.9rem;
            color: #b0c4de;
        }

        @media (max-width: 768px) {
            .container {
                padding: 5rem 1rem 1rem;
            }

            .stats-section {
                grid-template-columns: 1fr;
            }

            .control-buttons {
                flex-direction: column;
            }

            .control-btn {
                width: 100%;
                text-align: center;
            }

            .legend {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div>
            <h1>ğŸ—ºï¸ Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª</h1>
            <div class="subtitle">Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ</div>
        </div>
        <div class="nav-links">
            <a href="/">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="/threat-map" class="active">Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª</a>
            <a href="/analytics">Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</a>
            <a href="/iot-monitor">Ù…Ø±Ø§Ù‚Ø¨Ø© IoT</a>
            <a href="/encryption-analysis">ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ´ÙÙŠØ±</a>
            <a href="/settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
        </div>
    </nav>

    <div class="container">
        <div class="stats-section">
            <div class="stat-card">
                <span class="stat-icon">ğŸŒ</span>
                <div class="stat-value" id="global-threats">247</div>
                <div class="stat-label">Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©</div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">ğŸš¨</span>
                <div class="stat-value" id="active-attacks">89</div>
                <div class="stat-label">Ø§Ù„Ù‡Ø¬Ù…Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">ğŸ›¡ï¸</span>
                <div class="stat-value" id="blocked-attacks">158</div>
                <div class="stat-label">Ø§Ù„Ù‡Ø¬Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø¸ÙˆØ±Ø©</div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">âš¡</span>
                <div class="stat-value" id="response-time">1.2s</div>
                <div class="stat-label">ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</div>
            </div>
        </div>

        <div class="controls-section">
            <h3>ğŸ›ï¸ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</h3>
            <div class="control-buttons">
                <button class="control-btn active" id="show-critical">ğŸ”´ Ø­Ø±Ø¬</button>
                <button class="control-btn active" id="show-high">ğŸŸ  Ù…Ø±ØªÙØ¹</button>
                <button class="control-btn active" id="show-medium">ğŸŸ¡ Ù…ØªÙˆØ³Ø·</button>
                <button class="control-btn active" id="show-low">ğŸŸ¢ Ù…Ù†Ø®ÙØ¶</button>
                <button class="control-btn" id="auto-refresh">ğŸ”„ ØªÙ„Ù‚Ø§Ø¦ÙŠ</button>
                <button class="control-btn" id="export-map">ğŸ’¾ ØªØµØ¯ÙŠØ±</button>
            </div>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-dot critical"></div>
                    <span>Ø­Ø±Ø¬ (Critical)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot high"></div>
                    <span>Ù…Ø±ØªÙØ¹ (High)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot medium"></div>
                    <span>Ù…ØªÙˆØ³Ø· (Medium)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot low"></div>
                    <span>Ù…Ù†Ø®ÙØ¶ (Low)</span>
                </div>
            </div>
        </div>

        <div class="map-section">
            <h3>ğŸŒ Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©</h3>
            <div class="map-container">
                <div class="world-map">ğŸŒ</div>
                <!-- Threat nodes will be dynamically added here -->
            </div>
            <div id="threat-tooltip" class="threat-tooltip"></div>
        </div>

        <div class="threats-list">
            <h3>ğŸš¨ Ø¢Ø®Ø± Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª Ø§Ù„Ù…ÙƒØªØ´ÙØ©</h3>
            <div id="threats-container">
                <div class="threat-item">
                    <div class="threat-header">
                        <div class="threat-location">Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø¯Ø© - Ù†ÙŠÙˆÙŠÙˆØ±Ùƒ</div>
                        <div class="threat-severity severity-critical">Ø­Ø±Ø¬</div>
                    </div>
                    <div class="threat-details">
                        Ù‡Ø¬ÙˆÙ… DDoS Ù…ÙƒØ«Ù - ØªÙ… Ø­Ø¸Ø±Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ | IP: 192.168.1.100 | Ù†ÙˆØ¹: SYN Flood
                    </div>
                </div>

                <div class="threat-item">
                    <div class="threat-header">
                        <div class="threat-location">Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù…ØªØ­Ø¯Ø© - Ù„Ù†Ø¯Ù†</div>
                        <div class="threat-severity severity-high">Ù…Ø±ØªÙØ¹</div>
                    </div>
                    <div class="threat-details">
                        Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø®ØªØ±Ø§Ù‚ SQL Injection - ØªÙ… Ø§Ù„ÙƒØ´Ù ÙˆØ§Ù„Ø­Ø¸Ø± | IP: 203.0.113.45
                    </div>
                </div>

                <div class="threat-item">
                    <div class="threat-header">
                        <div class="threat-location">Ø£Ù„Ù…Ø§Ù†ÙŠØ§ - Ø¨Ø±Ù„ÙŠÙ†</div>
                        <div class="threat-severity severity-medium">Ù…ØªÙˆØ³Ø·</div>
                    </div>
                    <div class="threat-details">
                        Ù…Ø³Ø­ Ù…Ù†Ø§ÙØ° ØºÙŠØ± Ù…ØµØ±Ø­ Ø¨Ù‡ - Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…Ø³ØªÙ…Ø±Ø© | IP: 198.51.100.1
                    </div>
                </div>

                <div class="threat-item">
                    <div class="threat-header">
                        <div class="threat-location">Ø§Ù„ÙŠØ§Ø¨Ø§Ù† - Ø·ÙˆÙƒÙŠÙˆ</div>
                        <div class="threat-severity severity-low">Ù…Ù†Ø®ÙØ¶</div>
                    </div>
                    <div class="threat-details">
                        Ø­Ø±ÙƒØ© Ù…Ø´Ø¨ÙˆÙ‡Ø© - Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© | IP: 203.0.113.195
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let threatNodes = [];
        let autoRefresh = false;
        let visibleSeverities = ['critical', 'high', 'medium', 'low'];

        // Sample threat data
        const sampleThreats = [
            { id: 1, location: 'Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø¯Ø©', city: 'Ù†ÙŠÙˆÙŠÙˆØ±Ùƒ', severity: 'critical', x: 25, y: 35, ip: '192.168.1.100', type: 'DDoS Attack' },
            { id: 2, location: 'Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù…ØªØ­Ø¯Ø©', city: 'Ù„Ù†Ø¯Ù†', severity: 'high', x: 45, y: 25, ip: '203.0.113.45', type: 'SQL Injection' },
            { id: 3, location: 'Ø£Ù„Ù…Ø§Ù†ÙŠØ§', city: 'Ø¨Ø±Ù„ÙŠÙ†', severity: 'medium', x: 50, y: 30, ip: '198.51.100.1', type: 'Port Scanning' },
            { id: 4, location: 'Ø§Ù„ÙŠØ§Ø¨Ø§Ù†', city: 'Ø·ÙˆÙƒÙŠÙˆ', severity: 'low', x: 85, y: 35, ip: '203.0.113.195', type: 'Suspicious Activity' },
            { id: 5, location: 'Ø§Ù„ØµÙŠÙ†', city: 'Ø¨ÙƒÙŠÙ†', severity: 'high', x: 75, y: 35, ip: '192.0.2.1', type: 'Brute Force' },
            { id: 6, location: 'Ø±ÙˆØ³ÙŠØ§', city: 'Ù…ÙˆØ³ÙƒÙˆ', severity: 'critical', x: 60, y: 20, ip: '198.51.100.50', type: 'Malware' },
            { id: 7, location: 'Ø§Ù„Ù‡Ù†Ø¯', city: 'Ù…ÙˆÙ…Ø¨Ø§ÙŠ', severity: 'medium', x: 70, y: 50, ip: '203.0.113.100', type: 'Phishing' },
            { id: 8, location: 'Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„', city: 'Ø³Ø§Ùˆ Ø¨Ø§ÙˆÙ„Ùˆ', severity: 'low', x: 35, y: 70, ip: '192.0.2.100', type: 'Spam' }
        ];

        // Initialize threat nodes
        function initThreatNodes() {
            const mapContainer = document.querySelector('.map-container');

            sampleThreats.forEach(threat => {
                const node = document.createElement('div');
                node.className = `threat-node ${threat.severity}`;
                node.textContent = threat.id;
                node.style.left = `${threat.x}%`;
                node.style.top = `${threat.y}%`;

                // Add tooltip on hover
                node.addEventListener('mouseenter', (e) => {
                    showTooltip(e, threat);
                });

                node.addEventListener('mouseleave', () => {
                    hideTooltip();
                });

                node.addEventListener('click', () => {
                    showThreatDetails(threat);
                });

                threatNodes.push({ element: node, data: threat });
                mapContainer.appendChild(node);
            });
        }

        // Show tooltip
        function showTooltip(event, threat) {
            const tooltip = document.getElementById('threat-tooltip');
            tooltip.innerHTML = `
                <strong>${threat.location} - ${threat.city}</strong><br>
                IP: ${threat.ip}<br>
                Ø§Ù„Ù†ÙˆØ¹: ${threat.type}<br>
                Ø§Ù„Ø®Ø·ÙˆØ±Ø©: ${getSeverityText(threat.severity)}
            `;
            tooltip.style.left = `${event.pageX + 10}px`;
            tooltip.style.top = `${event.pageY - 10}px`;
            tooltip.classList.add('show');
        }

        // Hide tooltip
        function hideTooltip() {
            document.getElementById('threat-tooltip').classList.remove('show');
        }

        // Get severity text in Arabic
        function getSeverityText(severity) {
            const texts = {
                'critical': 'Ø­Ø±Ø¬',
                'high': 'Ù…Ø±ØªÙØ¹',
                'medium': 'Ù…ØªÙˆØ³Ø·',
                'low': 'Ù…Ù†Ø®ÙØ¶'
            };
            return texts[severity] || severity;
        }

        // Show threat details
        function showThreatDetails(threat) {
            alert(`ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯:\n\nØ§Ù„Ù…ÙˆÙ‚Ø¹: ${threat.location} - ${threat.city}\nIP: ${threat.ip}\nØ§Ù„Ù†ÙˆØ¹: ${threat.type}\nØ§Ù„Ø®Ø·ÙˆØ±Ø©: ${getSeverityText(threat.severity)}`);
        }

        // Filter threats by severity
        function filterThreats() {
            threatNodes.forEach(({ element, data }) => {
                if (visibleSeverities.includes(data.severity)) {
                    element.style.display = 'flex';
                } else {
                    element.style.display = 'none';
                }
            });
        }

        // Setup controls
        function setupControls() {
            // Severity filters
            ['critical', 'high', 'medium', 'low'].forEach(severity => {
                const btn = document.getElementById(`show-${severity}`);
                btn.addEventListener('click', () => {
                    btn.classList.toggle('active');
                    if (btn.classList.contains('active')) {
                        visibleSeverities.push(severity);
                    } else {
                        visibleSeverities = visibleSeverities.filter(s => s !== severity);
                    }
                    filterThreats();
                });
            });

            // Auto refresh
            document.getElementById('auto-refresh').addEventListener('click', function() {
                autoRefresh = !autoRefresh;
                this.classList.toggle('active');
                this.textContent = autoRefresh ? 'â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù' : 'ğŸ”„ ØªÙ„Ù‚Ø§Ø¦ÙŠ';

                if (autoRefresh) {
                    startAutoRefresh();
                }
            });

            // Export map
            document.getElementById('export-map').addEventListener('click', () => {
                alert('Ø³ÙŠØªÙ… ØªØµØ¯ÙŠØ± Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª');
            });
        }

        // Auto refresh functionality
        function startAutoRefresh() {
            if (autoRefresh) {
                // Simulate new threats
                setTimeout(() => {
                    addRandomThreat();
                    if (autoRefresh) startAutoRefresh();
                }, 10000); // Add new threat every 10 seconds
            }
        }

        // Add random threat
        function addRandomThreat() {
            const locations = ['Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø¯Ø©', 'Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù…ØªØ­Ø¯Ø©', 'Ø£Ù„Ù…Ø§Ù†ÙŠØ§', 'Ø§Ù„ÙŠØ§Ø¨Ø§Ù†', 'Ø§Ù„ØµÙŠÙ†'];
            const severities = ['low', 'medium', 'high', 'critical'];
            const types = ['Port Scanning', 'Brute Force', 'Malware', 'Phishing'];

            const newThreat = {
                id: threatNodes.length + 1,
                location: locations[Math.floor(Math.random() * locations.length)],
                city: 'Ù…Ø¯ÙŠÙ†Ø© Ø¬Ø¯ÙŠØ¯Ø©',
                severity: severities[Math.floor(Math.random() * severities.length)],
                x: Math.random() * 80 + 10,
                y: Math.random() * 60 + 20,
                ip: `192.168.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`,
                type: types[Math.floor(Math.random() * types.length)]
            };

            const node = document.createElement('div');
            node.className = `threat-node ${newThreat.severity}`;
            node.textContent = newThreat.id;
            node.style.left = `${newThreat.x}%`;
            node.style.top = `${newThreat.y}%`;

            node.addEventListener('mouseenter', (e) => showTooltip(e, newThreat));
            node.addEventListener('mouseleave', () => hideTooltip());
            node.addEventListener('click', () => showThreatDetails(newThreat));

            threatNodes.push({ element: node, data: newThreat });
            document.querySelector('.map-container').appendChild(node);

            // Update stats
            updateStats();
        }

        // Update statistics
        function updateStats() {
            document.getElementById('global-threats').textContent = threatNodes.length;
            document.getElementById('active-attacks').textContent =
                threatNodes.filter(t => ['critical', 'high'].includes(t.data.severity)).length;
            document.getElementById('blocked-attacks').textContent =
                Math.floor(threatNodes.length * 0.7);
        }

        // Update data from API
        async function updateFromAPI() {
            try {
                const response = await fetch('/api/threats');
                const data = await response.json();

                if (data.ip_threats) {
                    // Update stats based on real data
                    document.getElementById('global-threats').textContent = data.total_threats || threatNodes.length;
                }
            } catch (error) {
                console.error('Error updating from API:', error);
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initThreatNodes();
            setupControls();
            updateStats();
            updateFromAPI();

            // Update from API every 30 seconds
            setInterval(updateFromAPI, 30000);
        });
    </script>
</body>
</html>
