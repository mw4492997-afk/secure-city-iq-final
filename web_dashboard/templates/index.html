<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ›¡ï¸ Secure City IQ - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0a0e27 0%, #1a2a4e 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .navbar {
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #9b59b6;
            padding: 1rem 2rem;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }

        .navbar h1 {
            color: #9b59b6;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .navbar .subtitle {
            color: #8e44ad;
            font-size: 0.9rem;
            margin-top: 0.2rem;
        }

        .nav-links {
            position: absolute;
            left: 2rem;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
        }

        .nav-links a {
            color: #8e44ad;
            text-decoration: none;
            margin-left: 1.5rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .nav-links a:hover, .nav-links a.active {
            background: rgba(155, 89, 182, 0.2);
            color: #bb8fce;
        }

        .auth-links {
            margin-left: 2rem;
            display: flex;
            gap: 1rem;
        }

        .auth-links a {
            color: #bb8fce;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .auth-links .login-btn {
            background: rgba(155, 89, 182, 0.2);
            border: 1px solid rgba(155, 89, 182, 0.5);
        }

        .auth-links .register-btn {
            background: rgba(46, 204, 113, 0.2);
            border: 1px solid rgba(46, 204, 113, 0.5);
            color: #7fffd4;
        }

        .auth-links .logout-btn {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid rgba(231, 76, 60, 0.5);
            color: #ff6b6b;
        }

        .auth-links a:hover {
            transform: translateY(-2px);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 6rem 2rem 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(26, 42, 78, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(155, 89, 182, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #9b59b6, #bb8fce);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            display: block;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #bb8fce;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 1.1rem;
            color: #b0c4de;
            font-weight: 500;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-card {
            background: rgba(26, 42, 78, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(155, 89, 182, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
        }

        .chart-card h3 {
            color: #9b59b6;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            text-align: center;
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .recent-activity {
            background: rgba(26, 42, 78, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(155, 89, 182, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .recent-activity h3 {
            color: #9b59b6;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .activity-item {
            background: rgba(155, 89, 182, 0.1);
            border: 1px solid rgba(155, 89, 182, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
        }

        .activity-icon {
            font-size: 1.5rem;
            margin-left: 1rem;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            margin-bottom: 0.2rem;
        }

        .activity-time {
            font-size: 0.8rem;
            color: #b0c4de;
        }

        .quick-actions {
            background: rgba(26, 42, 78, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(155, 89, 182, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
        }

        .quick-actions h3 {
            color: #9b59b6;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .action-btn {
            background: rgba(155, 89, 182, 0.2);
            border: 1px solid rgba(155, 89, 182, 0.5);
            color: #bb8fce;
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            text-decoration: none;
            display: block;
        }

        .action-btn:hover {
            background: rgba(155, 89, 182, 0.4);
            transform: translateY(-2px);
        }

        .status-indicator {
            position: absolute;
            top: 1rem;
            left: 1rem;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff88;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .status-indicator.warning {
            background: #ffaa00;
            box-shadow: 0 0 10px rgba(255, 170, 0, 0.5);
        }

        .status-indicator.danger {
            background: #ff4444;
            box-shadow: 0 0 10px rgba(255, 68, 68, 0.5);
        }

        @media (max-width: 768px) {
            .container {
                padding: 5rem 1rem 1rem;
            }

            .stats-grid, .charts-grid, .action-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div>
            <h1>ğŸ›¡ï¸ Secure City IQ</h1>
            <div class="subtitle">Ù†Ø¸Ø§Ù… Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø°ÙƒÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</div>
        </div>
        <div class="nav-links">
            <a href="/" class="active">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="/threat-map">Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª</a>
            <a href="/analytics">Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</a>
            <a href="/iot-monitor">Ù…Ø±Ø§Ù‚Ø¨Ø© IoT</a>
            <a href="/encryption-analysis">ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ´ÙÙŠØ±</a>
            <a href="/settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
        </div>
    </nav>

    <div class="container">
        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-icon">ğŸ“¦</span>
                <div class="stat-value" id="packets-count">0</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø²Ù…</div>
                <div class="status-indicator"></div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">ğŸš¨</span>
                <div class="stat-value" id="threats-count">0</div>
                <div class="stat-label">Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª Ø§Ù„Ù…ÙƒØªØ´ÙØ©</div>
                <div class="status-indicator warning"></div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">âœ…</span>
                <div class="stat-value" id="safe-count">0</div>
                <div class="stat-label">Ø§Ù„Ø­Ø²Ù… Ø§Ù„Ø¢Ù…Ù†Ø©</div>
                <div class="status-indicator"></div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">ğŸ“ˆ</span>
                <div class="stat-value" id="attack-rate">0%</div>
                <div class="stat-label">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù‡Ø¬ÙˆÙ…</div>
                <div class="status-indicator danger"></div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-card">
                <h3>ğŸ“Š ØªÙˆØ²ÙŠØ¹ Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ©</h3>
                <div class="chart-container">
                    <canvas id="protocolChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3>ğŸŒ Ø§Ù„Ù†Ø´Ø§Ø· Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª</h3>
                <div class="chart-container">
                    <canvas id="activityChart"></canvas>
                </div>
            </div>
        </div>

        <div class="recent-activity">
            <h3>ğŸ“‹ Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©</h3>
            <div id="activity-list">
                <div class="activity-item">
                    <span class="activity-icon">ğŸ”</span>
                    <div class="activity-content">
                        <div class="activity-title">Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø´Ø¨ÙƒØ©</div>
                        <div class="activity-time">Ù…Ù†Ø° Ø¯Ù‚ÙŠÙ‚ØªÙŠÙ†</div>
                    </div>
                </div>
                <div class="activity-item">
                    <span class="activity-icon">âš ï¸</span>
                    <div class="activity-content">
                        <div class="activity-title">ÙƒØ´Ù Ù…Ø­Ø§ÙˆÙ„Ø© ÙˆØµÙˆÙ„ Ù…Ø´Ø¨ÙˆÙ‡Ø©</div>
                        <div class="activity-time">Ù…Ù†Ø° 5 Ø¯Ù‚Ø§Ø¦Ù‚</div>
                    </div>
                </div>
                <div class="activity-item">
                    <span class="activity-icon">âœ…</span>
                    <div class="activity-content">
                        <div class="activity-title">ØªØ­Ù„ÙŠÙ„ Ø­Ø²Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙƒØªÙ…Ù„</div>
                        <div class="activity-time">Ù…Ù†Ø° 10 Ø¯Ù‚Ø§Ø¦Ù‚</div>
                    </div>
                </div>
                <div class="activity-item">
                    <span class="activity-icon">ğŸ”’</span>
                    <div class="activity-content">
                        <div class="activity-title">ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù†</div>
                        <div class="activity-time">Ù…Ù†Ø° 15 Ø¯Ù‚ÙŠÙ‚Ø©</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="quick-actions">
            <h3>âš¡ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</h3>
            <div class="action-buttons">
                <a href="/threat-map" class="action-btn">Ø¹Ø±Ø¶ Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª</a>
                <a href="/analytics" class="action-btn">Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</a>
                <a href="/iot-monitor" class="action-btn">Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</a>
                <a href="/encryption-analysis" class="action-btn">ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ´ÙÙŠØ±</a>
                <a href="/settings" class="action-btn">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
                <button class="action-btn" id="export-report">ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
            </div>
        </div>
    </div>

    <script>
        let protocolChart = null;
        let activityChart = null;

        // Initialize charts
        function initCharts() {
            // Protocol Distribution Chart
            const ctx1 = document.getElementById('protocolChart').getContext('2d');
            protocolChart = new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: ['TCP', 'UDP', 'ICMP', 'HTTP', 'HTTPS', 'Ø£Ø®Ø±Ù‰'],
                    datasets: [{
                        data: [40, 30, 15, 8, 5, 2],
                        backgroundColor: [
                            '#9b59b6',
                            '#3498db',
                            '#e74c3c',
                            '#2ecc71',
                            '#f39c12',
                            '#95a5a6'
                        ],
                        borderWidth: 2,
                        borderColor: '#1a2a4e'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#ffffff' }
                        }
                    }
                }
            });

            // Activity Chart
            const ctx2 = document.getElementById('activityChart').getContext('2d');
            activityChart = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
                    datasets: [{
                        label: 'Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø´Ø¨ÙƒÙŠ',
                        data: [20, 45, 80, 65, 90, 55],
                        borderColor: '#00d4ff',
                        backgroundColor: 'rgba(0, 212, 255, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#ffffff' }
                        },
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#ffffff' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: '#ffffff' } }
                    }
                }
            });
        }

        // Update dashboard data
        async function updateDashboard() {
            try {
                const response = await fetch('/api/dashboard');
                const data = await response.json();

                if (data.status === 'success') {
                    const dashboardData = data.data;

                    // Update stats
                    document.getElementById('packets-count').textContent = dashboardData.packets || 0;
                    document.getElementById('threats-count').textContent = dashboardData.threats || 0;
                    document.getElementById('safe-count').textContent = dashboardData.safe_packets || 0;
                    document.getElementById('attack-rate').textContent = (dashboardData.attack_rate || 0) + '%';

                    // Update protocol chart
                    if (protocolChart && dashboardData.tcp_count !== undefined) {
                        protocolChart.data.datasets[0].data = [
                            dashboardData.tcp_count || 0,
                            dashboardData.udp_count || 0,
                            dashboardData.icmp_count || 0,
                            Math.floor(Math.random() * 20), // HTTP
                            Math.floor(Math.random() * 15), // HTTPS
                            Math.floor(Math.random() * 10)  // Other
                        ];
                        protocolChart.update();
                    }

                    // Update activity chart with some variation
                    if (activityChart) {
                        activityChart.data.datasets[0].data = activityChart.data.datasets[0].data.map(val =>
                            Math.max(0, val + (Math.random() - 0.5) * 20)
                        );
                        activityChart.update();
                    }
                }
            } catch (error) {
                console.error('Error updating dashboard:', error);
            }
        }

        // Export report
        document.getElementById('export-report').addEventListener('click', async () => {
            try {
                const response = await fetch('/api/export-report');
                const data = await response.json();
                if (data.status === 'success') {
                    alert(`ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­: ${data.filename}`);
                } else {
                    alert('ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±');
                }
            } catch (error) {
                alert('Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±');
            }
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            updateDashboard();

            // Update every 5 seconds
            setInterval(updateDashboard, 5000);
        });
    </script>
</body>
</html>
